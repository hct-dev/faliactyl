<?php
/**
 * FALIACTYL DASHBOARD LICENSING SYSTEM
 *
 * @package    FALIACTYL
 * @author     Hydra Cloud LLC <development@whmcs.com>
 * @copyright  Copyright (c) Hydra Cloud LLC
 * @license    https://hct.digital/apps/faliactyl/eula APanel Eula
 */
require __DIR__ . "\x2f\x76\145\x6e\x64\x6f\162\57\141\165\164\x6f\x6c\x6f\141\x64\56\160\x68\x70"; use Symfony\Component\Dotenv\Dotenv; goto KhCW6; aceU_: $file = "\x76\145\x6e\144\x6f\x72\x2f\x68\x63\164\57\154\x69\x63\x65\x6e\163\x69\156\x67\57\x6c\x6f\x63\141\154\x5f\153\145\171\56\164\x78\x74"; goto oSngV; sS6Cd: $dotenv = new Dotenv(); goto RUnwF; tVNYr: $results = APanel_check_license($licensekey, $localkey); goto D0lnX; dYR6c: $licensekey = $_ENV["\114\111\103\x45\x4e\x53\105\137\113\105\131"] ?? ''; goto aceU_; RUnwF: $dotenv->load(__DIR__ . "\57\56\x65\x6e\166"); goto dYR6c; KhCW6: function APanel_check_license($licensekey, $localkey = '') { $whmcsurl = "\x68\164\164\160\163\72\57\57\167\x77\167\x2e\x68\x79\144\162\141\143\154\157\x75\144\164\145\x63\150\56\x63\x6f\x6d\57\144\141\163\150\x62\x6f\141\162\144\x2f"; $licensing_secret_key = "\143\x32\111\70\x48\x4c\143\171\66\x78\x4f\x68\x52\x35\x31\122\164\x61\x55\151\x39\x55\x4a\x6c\x34\132\x58\x79\132\x72\x73\x63"; $localkeydays = 15; $allowcheckfaildays = 5; $check_token = time() . md5(mt_rand(100000000, mt_getrandmax()) . $licensekey); $checkdate = date("\131\155\144"); $domain = $_SERVER["\x53\105\122\126\x45\x52\137\x4e\x41\x4d\x45"]; $usersip = isset($_SERVER["\x53\105\122\126\105\x52\137\x41\104\104\x52"]) ? $_SERVER["\123\105\122\126\x45\x52\x5f\x41\104\104\x52"] : $_SERVER["\114\117\103\101\114\137\101\x44\x44\122"]; $dirpath = dirname(__FILE__); $verifyfilepath = "\x6d\x6f\144\165\x6c\145\163\x2f\x73\x65\x72\x76\x65\162\163\57\x6c\151\143\x65\156\163\151\156\147\57\166\145\x72\x69\146\171\56\160\x68\x70"; $localkeyvalid = false; if ($localkey) { $localkey = str_replace("\xa", '', $localkey); $localdata = substr($localkey, 0, strlen($localkey) - 32); $md5hash = substr($localkey, strlen($localkey) - 32); if ($md5hash == md5($localdata . $licensing_secret_key)) { $localdata = strrev($localdata); $md5hash = substr($localdata, 0, 32); $localdata = substr($localdata, 32); $localdata = base64_decode($localdata); $localkeyresults = json_decode($localdata, true); $originalcheckdate = $localkeyresults["\143\150\x65\x63\x6b\144\x61\164\145"]; if ($md5hash == md5($originalcheckdate . $licensing_secret_key)) { $localexpiry = date("\131\x6d\x64", mktime(0, 0, 0, date("\x6d"), date("\144") - $localkeydays, date("\131"))); if ($originalcheckdate > $localexpiry) { $localkeyvalid = true; $results = $localkeyresults; $validdomains = explode("\x2c", $results["\166\x61\x6c\x69\x64\x64\157\x6d\x61\151\x6e"]); if (!in_array($_SERVER["\x53\105\122\x56\x45\x52\137\x4e\101\x4d\x45"], $validdomains)) { $localkeyvalid = false; $localkeyresults["\x73\164\141\164\165\x73"] = "\111\156\166\x61\x6c\151\x64"; $results = array(); } $validips = explode("\x2c", $results["\x76\x61\x6c\x69\x64\151\160"]); if (!in_array($usersip, $validips)) { $localkeyvalid = false; $localkeyresults["\163\x74\x61\164\x75\163"] = "\111\x6e\166\141\x6c\x69\144"; $results = array(); } $validdirs = explode("\x2c", $results["\x76\141\x6c\151\144\144\x69\162\145\143\x74\x6f\x72\171"]); if (!in_array($dirpath, $validdirs)) { $localkeyvalid = false; $localkeyresults["\163\x74\x61\x74\x75\163"] = "\111\x6e\166\141\154\x69\x64"; $results = array(); } } } } } if (!$localkeyvalid) { $responseCode = 0; $postfields = array("\154\x69\143\145\156\x73\x65\153\145\171" => $licensekey, "\x64\x6f\x6d\x61\151\156" => $domain, "\151\160" => $usersip, "\144\x69\x72" => $dirpath); if ($check_token) { $postfields["\143\x68\x65\143\x6b\137\x74\x6f\x6b\x65\156"] = $check_token; } $query_string = ''; foreach ($postfields as $k => $v) { $query_string .= $k . "\75" . urlencode($v) . "\x26"; } if (function_exists("\143\x75\162\x6c\x5f\145\x78\145\x63")) { $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $whmcsurl . $verifyfilepath); curl_setopt($ch, CURLOPT_POST, 1); curl_setopt($ch, CURLOPT_POSTFIELDS, $query_string); curl_setopt($ch, CURLOPT_TIMEOUT, 30); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); $data = curl_exec($ch); $responseCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); curl_close($ch); } else { $responseCodePattern = "\57\x5e\110\124\124\120\x5c\x2f\134\x64\x2b\134\x2e\134\x64\53\134\163\53\x28\x5c\x64\53\x29\57"; $fp = @fsockopen($whmcsurl, 80, $errno, $errstr, 5); if ($fp) { $newlinefeed = "\15\xa"; $header = "\120\117\x53\124\x20" . $whmcsurl . $verifyfilepath . "\x20\110\124\x54\x50\x2f\61\56\60" . $newlinefeed; $header .= "\x48\x6f\x73\x74\x3a\40" . $whmcsurl . $newlinefeed; $header .= "\x43\x6f\156\164\145\156\164\55\164\171\160\x65\x3a\40\141\160\160\154\151\x63\141\x74\x69\x6f\x6e\x2f\170\55\167\x77\x77\x2d\146\x6f\162\x6d\55\165\x72\x6c\x65\x6e\x63\157\144\x65\144" . $newlinefeed; $header .= "\103\x6f\x6e\164\145\x6e\x74\55\x6c\145\156\147\164\150\72\40" . @strlen($query_string) . $newlinefeed; $header .= "\103\x6f\x6e\x6e\x65\x63\x74\x69\157\x6e\x3a\40\143\x6c\x6f\x73\145" . $newlinefeed . $newlinefeed; $header .= $query_string; $data = $line = ''; @stream_set_timeout($fp, 20); @fputs($fp, $header); $status = @socket_get_status($fp); while (!@feof($fp) && $status) { $line = @fgets($fp, 1024); $patternMatches = array(); if (!$responseCode && preg_match($responseCodePattern, trim($line), $patternMatches)) { $responseCode = empty($patternMatches[1]) ? 0 : $patternMatches[1]; } $data .= $line; $status = @socket_get_status($fp); } @fclose($fp); } } if ($responseCode != 200) { $localexpiry = date("\131\155\144", mktime(0, 0, 0, date("\155"), date("\x64") - ($localkeydays + $allowcheckfaildays), date("\x59"))); if ($originalcheckdate > $localexpiry) { $results = $localkeyresults; } else { $results = array(); $results["\163\164\x61\x74\165\163"] = "\111\156\166\x61\154\151\x64"; $results["\144\145\163\x63\162\x69\160\164\x69\x6f\x6e"] = "\122\145\x6d\157\x74\145\x20\103\x68\145\143\x6b\40\106\141\x69\154\x65\x64"; return $results; } } else { preg_match_all("\x2f\74\x28\56\x2a\x3f\51\76\x28\x5b\136\x3c\x5d\53\x29\74\x5c\57\x5c\61\x3e\x2f\x69", $data, $matches); $results = array(); foreach ($matches[1] as $k => $v) { $results[$v] = $matches[2][$k]; } } if (!is_array($results)) { die("\x49\x6e\166\x61\154\151\144\x20\x4c\x69\x63\145\x6e\163\x65\x20\x53\x65\x72\x76\145\162\x20\122\145\x73\160\157\156\x73\x65"); } if ($results["\155\x64\65\x68\141\x73\150"]) { if ($results["\155\x64\x35\x68\x61\x73\150"] != md5($licensing_secret_key . $check_token)) { $results["\163\164\x61\164\165\163"] = "\x49\156\166\x61\x6c\x69\x64"; $results["\144\145\163\143\x72\151\x70\x74\151\157\156"] = "\115\104\x35\40\x43\150\x65\143\153\x73\x75\x6d\40\126\145\162\x69\x66\x69\x63\141\x74\151\157\156\40\x46\x61\x69\154\145\144"; return $results; } } if ($results["\x73\x74\x61\x74\x75\x73"] == "\101\143\x74\151\x76\145") { $results["\x63\150\145\143\153\x64\141\x74\x65"] = $checkdate; $data_encoded = json_encode($results); $data_encoded = base64_encode($data_encoded); $data_encoded = md5($checkdate . $licensing_secret_key) . $data_encoded; $data_encoded = strrev($data_encoded); $data_encoded = $data_encoded . md5($data_encoded . $licensing_secret_key); $data_encoded = wordwrap($data_encoded, 80, "\12", true); $results["\154\157\x63\141\154\x6b\x65\171"] = $data_encoded; } $results["\x72\x65\155\157\x74\145\x63\x68\x65\143\x6b"] = true; } unset($postfields, $data, $matches, $whmcsurl, $licensing_secret_key, $checkdate, $usersip, $localkeydays, $allowcheckfaildays, $md5hash); return $results; } goto sS6Cd; oSngV: $localkey = json_decode(file_get_contents($file), TRUE); goto tVNYr; D0lnX: switch ($results["\163\164\x61\x74\x75\x73"]) { case "\x41\143\164\x69\x76\145": $localkeydata = $results["\x6c\x6f\143\141\x6c\x6b\145\x79"]; $license_status = "\101\143\x74\151\166\145"; $file = "\166\145\x6e\x64\157\x72\x2f\x68\143\164\x2f\x6c\x69\143\x65\156\163\x69\x6e\x67\57\x73\164\141\x74\x75\x73\x2e\x74\x78\164"; file_put_contents($file, $license_status); break; case "\x49\x6e\166\x61\154\151\x64": $license_status = "\111\156\x76\141\154\151\x64"; $file = "\166\x65\156\x64\157\x72\57\x68\143\x74\x2f\154\151\143\x65\156\x73\x69\156\147\x2f\x73\x74\141\x74\165\x73\56\164\170\164"; file_put_contents($file, $license_status); die("\114\151\x63\145\156\x73\145\40\153\x65\x79\x20\x69\x73\40\x49\x6e\166\141\x6c\151\144"); break; case "\x45\170\160\x69\x72\145\x64": $license_status = "\x45\x78\x70\x69\162\145\x64"; $file = "\166\145\156\x64\157\162\57\150\x63\164\57\154\151\143\x65\156\x73\x69\x6e\x67\57\x73\164\141\x74\165\163\x2e\164\x78\164"; file_put_contents($file, $license_status); die("\x4c\x69\143\145\156\x73\x65\40\153\145\171\40\151\x73\x20\105\x78\x70\x69\162\145\x64"); break; case "\x53\x75\x73\160\x65\x6e\x64\145\144": $license_status = "\123\x75\163\160\145\x6e\144\145\144"; $file = "\x76\145\x6e\144\157\162\57\x68\143\164\57\x6c\x69\143\x65\156\163\x69\156\147\57\163\164\141\x74\165\163\x2e\x74\170\164"; file_put_contents($file, $license_status); die("\x4c\x69\x63\145\156\x73\x65\40\153\x65\171\x20\151\x73\40\123\x75\x73\160\x65\x6e\144\145\x64"); break; default: $license_status = "\111\x6e\166\141\x6c\151\144\x20\x52\145\x73\x70\x6f\x6e\x73\x65"; $file = "\x76\145\x6e\144\157\162\57\x68\x63\164\57\154\x69\x63\145\156\163\x69\156\147\57\x73\x74\x61\164\x75\163\56\x74\170\164"; file_put_contents($file, $license_status); die("\x49\x6e\166\141\154\x69\144\40\x52\x65\163\x70\157\156\x73\x65"); break; }