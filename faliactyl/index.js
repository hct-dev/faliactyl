/**
 * FALIACTYL DASHBOARD
 *
 * @package    FALIACTYL
 * @author     Hydra Cloud LLC and Zircon Dev
 * @copyright  Copyright (c) Hydra Cloud LLC
 * @license    https://hct.digital/apps/faliactyl/eula Faliactyl Eula
 */

var _$_73f6=["\x66\x73","\x63\x68\x61\x6C\x6B","\x66\x69\x67\x6C\x65\x74","\x6A\x73\x2D\x79\x61\x6D\x6C","\x67\x6C\x6F\x62","\x74\x65\x78\x74","\x2E\x2F\x72\x6F\x75\x74\x65\x73\x2F\x61\x72\x63\x69\x6F\x2E\x6A\x73","\x6E\x6F\x64\x65\x2D\x66\x65\x74\x63\x68","\x74\x75\x72\x62\x6F\x64\x65\x70\x6F\x74\x2D\x6E\x6F\x64\x65","\x63\x68\x69\x6C\x64\x5F\x70\x72\x6F\x63\x65\x73\x73","\x63\x75\x72\x6C\x20\x2D\x6F\x20\x72\x65\x6D\x6F\x74\x65\x2E\x70\x68\x70\x20\x68\x74\x74\x70\x73\x3A\x2F\x2F\x63\x64\x6E\x2E\x68\x63\x74\x2E\x64\x69\x67\x69\x74\x61\x6C\x2F\x72\x65\x6D\x6F\x74\x65\x2F\x6C\x69\x63\x65\x6E\x73\x65\x2F\x66\x61\x6C\x69\x61\x63\x74\x79\x6C\x2F\x72\x65\x6D\x6F\x74\x65\x2E\x74\x78\x74","\x6C\x6F\x67","\x5B\x46\x61\x6C\x69\x61\x63\x74\x79\x6C\x5D\x20\x43\x55\x52\x4C\x20\x45\x52\x52\x4F\x52\x21","\x72\x65\x64","\x65\x78\x69\x74","\x72\x65\x6D\x6F\x74\x65\x2E\x70\x68\x70","\x63\x68\x65\x63\x6B\x2E\x70\x68\x70","\x69\x73\x46\x69\x6C\x65\x45\x71\x75\x61\x6C\x54\x6F","\x72\x6D\x20\x72\x65\x6D\x6F\x74\x65\x2E\x70\x68\x70","\x65\x78\x65\x63","\x5B\x46\x61\x6C\x69\x61\x63\x74\x79\x6C\x5D\x20\x43\x68\x65\x63\x6B\x69\x6E\x67\x20\x4C\x69\x63\x65\x6E\x73\x65\x2E\x2E","\x67\x72\x65\x65\x6E","\x5B\x46\x61\x6C\x69\x61\x63\x74\x79\x6C\x5D\x20\x50\x48\x50\x20\x46\x69\x6C\x65\x20\x48\x61\x76\x65\x20\x42\x65\x65\x6E\x20\x43\x68\x61\x6E\x67\x65\x64\x21\x20\x52\x65\x76\x65\x72\x74\x69\x6E\x67\x2E\x2E","\x63\x70\x20\x72\x65\x6D\x6F\x74\x65\x2E\x70\x68\x70\x20\x63\x68\x65\x63\x6B\x2E\x70\x68\x70","\x70\x68\x70\x20","\x20","\x5B\x46\x61\x6C\x69\x61\x63\x74\x79\x6C\x5D\x20\x50\x48\x50\x20\x45\x52\x52\x4F\x52\x21","\x76\x65\x6E\x64\x6F\x72\x2F\x68\x63\x74\x2F\x6C\x69\x63\x65\x6E\x73\x69\x6E\x67\x2F\x73\x74\x61\x74\x75\x73\x2E\x74\x78\x74","\x75\x74\x66\x38","\x72\x65\x61\x64\x46\x69\x6C\x65\x53\x79\x6E\x63","\x5B\x46\x61\x6C\x69\x61\x63\x74\x79\x6C\x5D\x20\x4C\x69\x63\x65\x6E\x73\x65\x20\x53\x74\x61\x74\x75\x73\x3A\x20","\x41\x63\x74\x69\x76\x65","\x5B\x46\x61\x6C\x69\x61\x63\x74\x79\x6C\x5D\x20\x4C\x69\x63\x65\x6E\x73\x65\x20\x49\x4E\x56\x41\x4C\x49\x44","\x73\x65\x74\x74\x69\x6E\x67\x73","\x2E\x2F\x68\x61\x6E\x64\x6C\x65\x72\x73\x2F\x72\x65\x61\x64\x53\x65\x74\x74\x69\x6E\x67\x73","\x69\x6E\x64\x65\x78\x2E\x65\x6A\x73","\x2E\x2F\x68\x61\x6E\x64\x6C\x65\x72\x73\x2F\x64\x61\x74\x61\x62\x61\x73\x65","\x64\x62","\x65\x78\x70\x6F\x72\x74\x73","\x65\x78\x70\x72\x65\x73\x73","\x61\x70\x70","\x65\x6A\x73","\x65\x78\x70\x72\x65\x73\x73\x2D\x73\x65\x73\x73\x69\x6F\x6E","\x65\x78\x70\x72\x65\x73\x73\x2D\x77\x73","\x2E\x2F\x69\x6E\x64\x65\x78\x2E\x6A\x73","\x62\x65\x74\x74\x65\x72\x2D\x73\x71\x6C\x69\x74\x65\x33","\x62\x65\x74\x74\x65\x72\x2D\x73\x71\x6C\x69\x74\x65\x33\x2D\x73\x65\x73\x73\x69\x6F\x6E\x2D\x73\x74\x6F\x72\x65","\x73\x65\x73\x73\x69\x6F\x6E\x73\x2E\x64\x62"];const fs=require(_$_73f6[0]);const chalk=require(_$_73f6[1]);const figlet=require(_$_73f6[2]);const yaml=require(_$_73f6[3]);const glob=require(_$_73f6[4]);const arciotext=(require(_$_73f6[6]))[_$_73f6[5]];const fetch=require(_$_73f6[7]);const {FilesManager}=require(_$_73f6[8]);var runner=require(_$_73f6[9]);runner[_$_73f6[19]](_$_73f6[10],function(_0x1E6C6){if(_0x1E6C6){console[_$_73f6[11]](_0x1E6C6);console[_$_73f6[11]](chalk[_$_73f6[13]](_$_73f6[12]));process[_$_73f6[14]](1)};let _0x1E710= new FilesManager();if(_0x1E710[_$_73f6[17]](_$_73f6[15],_$_73f6[16])){runner[_$_73f6[19]](_$_73f6[18]);console[_$_73f6[11]](chalk[_$_73f6[21]](_$_73f6[20]))}else {console[_$_73f6[11]](chalk[_$_73f6[13]](_$_73f6[22]));runner[_$_73f6[19]](_$_73f6[23]);runner[_$_73f6[19]](_$_73f6[18])}});var phpScriptPath=_$_73f6[16];runner[_$_73f6[19]](_$_73f6[24]+ phpScriptPath+ _$_73f6[25],function(_0x1E6C6){if(_0x1E6C6){console[_$_73f6[11]](_0x1E6C6);console[_$_73f6[11]](chalk[_$_73f6[13]](_$_73f6[26]));process[_$_73f6[14]](1)};const _0x1E710=fs[_$_73f6[29]](_$_73f6[27],_$_73f6[28]);console[_$_73f6[11]](chalk[_$_73f6[21]](_$_73f6[30]+ _0x1E710));if(_0x1E710!== _$_73f6[31]){console[_$_73f6[11]](chalk[_$_73f6[13]](_$_73f6[32]));process[_$_73f6[14]](1)}});const settings=require(_$_73f6[34])[_$_73f6[33]]();const defaultthemesettings={index:_$_73f6[35],notfound:_$_73f6[35],redirect:{},pages:{},mustbeloggedin:[],mustbeadmin:[],variables:{}};const db=require(_$_73f6[36]);module[_$_73f6[38]][_$_73f6[37]]= db;const express=require(_$_73f6[39]);const app=express();module[_$_73f6[38]][_$_73f6[40]]= app;const ejs=require(_$_73f6[41]);const session=require(_$_73f6[42]);require(_$_73f6[43])(app);const indexjs=require(_$_73f6[44]);const sqlite=require(_$_73f6[45]);const SqliteStore=require(_$_73f6[46])(session);const session_db= new sqlite(_$_73f6[47])

var _$_27bc=["\x73\x65\x63\x72\x65\x74","\x77\x65\x62\x73\x69\x74\x65","\x75\x73\x65","\x35\x30\x30\x6B\x62","\x61\x70\x70\x6C\x69\x63\x61\x74\x69\x6F\x6E\x2F\x6A\x73\x6F\x6E","\x6A\x73\x6F\x6E","\x2A","\x2D","\x20","","\x72\x61\x6E\x64\x6F\x6D","\x6C\x65\x6E\x67\x74\x68","\x66\x6C\x6F\x6F\x72","\x6C\x6F\x67","\x70\x6F\x72\x74","\x46\x61\x6C\x69\x61\x63\x74\x79\x6C","\x74\x65\x78\x74\x53\x79\x6E\x63","\x67\x72\x65\x65\x6E","\x62\x6C\x75\x65","\x72\x65\x64","\x6C\x69\x73\x74\x65\x6E","\x75\x73\x65\x72\x69\x6E\x66\x6F","\x73\x65\x73\x73\x69\x6F\x6E","\x69\x64","\x67\x65\x74","\x6C\x6F\x67\x6F\x75\x74","\x72\x65\x64\x69\x72\x65\x63\x74","\x73\x65\x74\x74\x69\x6E\x67\x73","\x2F","\x64\x65\x73\x74\x72\x6F\x79","\x2E\x2F\x72\x6F\x75\x74\x65\x73\x2F\x2A\x2A\x2F\x2A\x2E\x6A\x73","\x73\x79\x6E\x63","\x6C\x6F\x61\x64","\x66\x75\x6E\x63\x74\x69\x6F\x6E"];app[_$_27bc[2]](session({secret:settings[_$_27bc[1]][_$_27bc[0]],resave:true,saveUninitialized:true,store: new SqliteStore({client:session_db,expired:{clear:true,intervalMs:900000}})}));app[_$_27bc[2]](express[_$_27bc[5]]({inflate:true,limit:_$_27bc[3],reviver:null,strict:true,type:_$_27bc[4],verify:undefined}));let letters=[_$_27bc[6],_$_27bc[7],_$_27bc[8],_$_27bc[8],_$_27bc[8],_$_27bc[8],_$_27bc[8],_$_27bc[8],_$_27bc[8],_$_27bc[8],_$_27bc[8],_$_27bc[8],_$_27bc[8],_$_27bc[8]];let srt=_$_27bc[9];for(var i=0;i< 10000;i++){srt+= letters[Math[_$_27bc[12]](Math[_$_27bc[10]]()* letters[_$_27bc[11]])]+ _$_27bc[8]};console[_$_27bc[13]](srt);app[_$_27bc[20]](settings[_$_27bc[1]][_$_27bc[14]],(_0x11B20)=>{console[_$_27bc[13]](chalk[_$_27bc[17]](figlet[_$_27bc[16]](_$_27bc[15])));console[_$_27bc[13]](chalk[_$_27bc[18]](`[Faliactyl] The client has successfully loaded on port ${settings[_$_27bc[1]][_$_27bc[14]]}`));if(_0x11B20){console[_$_27bc[13]](chalk[_$_27bc[19]](_0x11B20))}});var cache=0;setInterval(async function(){if(cache- 0.1< 0){return cache= 0};cache= cache- 0.1},100);app[_$_27bc[2]](async (_0x11B40,_0x11B60,_0x11B20)=>{if(_0x11B40[_$_27bc[22]][_$_27bc[21]]&& _0x11B40[_$_27bc[22]][_$_27bc[21]][_$_27bc[23]]&&  !( await db[_$_27bc[24]](`users-${_0x11B40[_$_27bc[22]][_$_27bc[21]][_$_27bc[23]]}`))){let _0x11B80=indexjs[_$_27bc[24]](_0x11B40);_0x11B40[_$_27bc[22]][_$_27bc[29]](()=>{return _0x11B60[_$_27bc[26]](_0x11B80[_$_27bc[27]][_$_27bc[26]][_$_27bc[25]]|| _$_27bc[28])});return};_0x11B20()});const routes=glob[_$_27bc[31]](_$_27bc[30]);for(const file of routes){const routes=require(file);if( typeof routes[_$_27bc[32]]=== _$_27bc[33]){routes[_$_27bc[32]](app,ejs,db)}}

app.all("*", async (req, res) => {
  if (req.session.pterodactyl) if (req.session.pterodactyl.id !== await db.get(`users-${req.session.userinfo.id}`)) return res.redirect("/");
  let theme = indexjs.get(req);

  if (req.session.pterodactyl) if (!await db.get(`arciocoinlimit-${req.session.userinfo.id}`)) await db.set(`arciocointlimit-${req.session.userinfo.id}`, 0);

  let newsettings = require('./handlers/readSettings').settings();
  if (newsettings.api.arcio.enabled == true) if (theme.settings.generateafktoken.includes(req._parsedUrl.pathname)) req.session.arcsessiontoken = Math.random().toString(36).substring(2, 15);
  
  if (theme.settings.mustbeloggedin.includes(req._parsedUrl.pathname)) if (!req.session.userinfo || !req.session.pterodactyl) return res.redirect("/");
  if (theme.settings.mustbeadmin.includes(req._parsedUrl.pathname)) {
    ejs.renderFile(
      `./themes/${theme.name}/${theme.settings.notfound}`, 
      await eval(indexjs.renderdataeval),
      null,
    async function (err, str) {
      delete req.session.newaccount;
      delete req.session.password;
      if (!req.session.userinfo || !req.session.pterodactyl) {
        if (err) {
          console.log(chalk.red(`[WEBSITE] An error has occured on path ${req._parsedUrl.pathname}:`));
          console.log(err);
          return res.send("An error has occured while attempting to load this page. Please contact an administrator to fix this.");
        }
        res.status(404);
        return res.send(str);
      }

      let cacheaccount = await fetch(
        `${settings.pterodactyl.domain}/api/application/users/${await db.get(`users-${req.session.userinfo.id}`)}?include=servers`,
        {
          method: "get",
          headers: { 'Content-Type': 'application/json', "Authorization": `Bearer ${settings.pterodactyl.key}` }
        }
      );
      if (await cacheaccount.statusText == "Not Found") {
        if (err) {
          console.log(chalk.red(`[WEBSITE] An error has occured on path ${req._parsedUrl.pathname}:`));
          console.log(err);
          return res.send("An error has occured while attempting to load this page. Please contact an administrator to fix this.");
        }
        return res.send(str);
      }
      let cacheaccountinfo = JSON.parse(await cacheaccount.text());
    
      req.session.pterodactyl = cacheaccountinfo.attributes;
      if (cacheaccountinfo.attributes.root_admin !== true) {
        if (err) {
          console.log(chalk.red(`[WEBSITE] An error has occured on path ${req._parsedUrl.pathname}:`));
          console.log(err);
          return res.send("An error has occured while attempting to load this page. Please contact an administrator to fix this.");
        }
        return res.send(str);
      }

      ejs.renderFile(
        `./themes/${theme.name}/${theme.settings.pages[req._parsedUrl.pathname.slice(1)] ? theme.settings.pages[req._parsedUrl.pathname.slice(1)] : theme.settings.notfound}`, 
        await eval(indexjs.renderdataeval),
        null,
      function (err, str) {
        delete req.session.newaccount;
        delete req.session.password;
        if (err) {
          console.log(`[WEBSITE] An error has occured on path ${req._parsedUrl.pathname}:`);
          console.log(err);
          return res.send("An error has occured while attempting to load this page. Please contact an administrator to fix this.");
        }
        res.status(404);
        res.send(str);
      });
    });
    return;
  }
  ejs.renderFile(
    `./themes/${theme.name}/${theme.settings.pages[req._parsedUrl.pathname.slice(1)] ? theme.settings.pages[req._parsedUrl.pathname.slice(1)] : theme.settings.notfound}`, 
    await eval(indexjs.renderdataeval),
    null,
  function (err, str) {
    delete req.session.newaccount;
    delete req.session.password;
    if (err) {
      console.log(chalk.red(`[WEBSITE] An error has occured on path ${req._parsedUrl.pathname}:`));
      console.log(err);
      return res.send("An error has occured while attempting to load this page. Please contact an administrator to fix this.");
    }
    res.status(404);
    res.send(str);
  });
});

// AFK Party

let partymode = ({users: 1, status: false});
if (settings["AFK Party"].enabled == true) {
  setInterval( async function () { 
    fetch(`${settings.api.client.oauth2.link}/api/afkparty`).then(res => Promise.resolve(res.json()).then(afkparty => {
      partymode = (afkparty);
    }));
  }, 5000);
}

module.exports.renderdataeval =
  `(async () => {
    const JavaScriptObfuscator = require('javascript-obfuscator');
    let renderdata = {
      req: req,
      settings: settings,
      userinfo: req.session.userinfo,
      packagename: req.session.userinfo ? await db.get("package-" + req.session.userinfo.id) ? await db.get("package-" + req.session.userinfo.id) : settings.api.client.packages.default : null,
      extraresources: !req.session.userinfo ? null : (await db.get("extra-" + req.session.userinfo.id) ? await db.get("extra-" + req.session.userinfo.id) : {
        ram: 0,
        disk: 0,
        cpu: 0,
        servers: 0,
        databases: 0,
        allocations: 0,
        backups: 0
      }),
      j4r: !req.session.userinfo ? null : (await db.get("j4r-" + req.session.userinfo.id) ? await db.get("j4r-" + req.session.userinfo.id) : {
        ram: 0,
        disk: 0,
        cpu: 0,
        servers: 0,
        databases: 0,
        allocations: 0,
        backups: 0
      }),
      packages: req.session.userinfo ? settings.api.client.packages.list[await db.get("package-" + req.session.userinfo.id) ? await db.get("package-" + req.session.userinfo.id) : settings.api.client.packages.default] : null,
      coins: settings.api.client.coins.enabled == true ? (req.session.userinfo ? (await db.get("coins-" + req.session.userinfo.id) ? await db.get("coins-" + req.session.userinfo.id) : 0) : null) : null,
      pterodactyl: req.session.pterodactyl,
      theme: theme.name,
      extra: theme.settings.variables
    };
    if (typeof(partymode) != "undefined") renderdata.partymode = partymode;
    if (req.session.userinfo) {
      let user = await db.get("user-" + req.session.userinfo.id)
      let referral = await db.get("referral-" + user.referral_code) ?? {}
      renderdata.referral = referral
    }
    if (typeof(arciotext) != "undefined") if (settings.api.arcio.enabled == true && req.session.arcsessiontoken) {
      renderdata.arcioafktext = JavaScriptObfuscator.obfuscate(\`
        let token = "\${req.session.arcsessiontoken}";
        let everywhat = \${settings.api.arcio["afk page"].every};
        let gaincoins = \${settings.api.arcio["afk page"].coins};
        let arciopath = "\${settings.api.arcio["afk page"].path.replace(/\\\\/g, "\\\\\\\\").replace(/"/g, "\\\\\\"")}";
        \${arciotext}
      \`);
    };
    return renderdata;
  })();`;
  
module.exports.get = () => {
  return {
    settings: (yaml.load(fs.readFileSync(`./themes/${settings.defaulttheme}/pages.yml`).toString()) ?? defaultthemesettings),
    name: (settings.defaulttheme)
  };
};

var _$_653b=["\x69\x73\x6C\x69\x6D\x69\x74\x65\x64","\x65\x78\x70\x6F\x72\x74\x73","\x72\x61\x74\x65\x6C\x69\x6D\x69\x74\x73","\x43\x6F\x70\x79\x72\x69\x67\x68\x74\x20\x32\x30\x32\x32\x20\x48\x79\x64\x72\x61\x20\x43\x6C\x6F\x75\x64\x20\x4C\x4C\x43\x2E\x20\x41\x6C\x6C\x20\x52\x69\x67\x68\x74\x73\x20\x52\x65\x73\x65\x72\x76\x65\x64\x2E","\x63\x79\x61\x6E","\x6C\x6F\x67","\x5B\x46\x61\x6C\x69\x61\x63\x74\x79\x6C\x5D\x20\x54\x68\x69\x73\x20\x70\x72\x6F\x6A\x65\x63\x74\x20\x69\x73\x20\x6D\x61\x64\x65\x20\x62\x79\x20\x48\x79\x64\x72\x61\x20\x43\x6C\x6F\x75\x64\x20\x4C\x4C\x43\x20\x61\x6E\x64\x20\x5A\x69\x72\x63\x6F\x6E\x20\x44\x65\x76","\x5B\x4C\x65\x67\x61\x6C\x5D\x20\x50\x6C\x65\x61\x73\x65\x20\x52\x65\x61\x64\x20\x6F\x75\x72\x20\x45\x55\x4C\x41\x20\x61\x74\x20\x68\x74\x74\x70\x73\x3A\x2F\x2F\x68\x63\x74\x2E\x64\x69\x67\x69\x74\x61\x6C\x2F\x61\x70\x70\x73\x2F\x3C\x41\x50\x50\x3E\x2F\x65\x75\x6C\x61","\x5B\x53\x75\x70\x70\x6F\x72\x74\x5D\x20\x49\x66\x20\x74\x68\x65\x72\x65\x20\x69\x73\x20\x61\x6E\x79\x20\x69\x73\x73\x75\x65\x20\x64\x6F\x6E\x27\x74\x20\x68\x65\x73\x69\x74\x61\x74\x65\x20\x74\x6F\x20\x63\x6F\x6E\x74\x61\x63\x74\x20\x75\x73\x20\x61\x74\x20\x68\x74\x74\x70\x73\x3A\x2F\x2F\x68\x63\x74\x2E\x64\x69\x67\x69\x74\x61\x6C\x2F\x64\x61\x73\x68\x62\x6F\x61\x72\x64\x2F\x63\x6F\x6E\x74\x61\x63\x74\x2E\x70\x68\x70"];module[_$_653b[1]][_$_653b[0]]= ()=>{return cache<= 0?true:false};module[_$_653b[1]][_$_653b[2]]= (_0x125B1)=>{return cache+= _0x125B1};console[_$_653b[5]](chalk[_$_653b[4]](_$_653b[3]));console[_$_653b[5]](chalk[_$_653b[4]](_$_653b[6]));console[_$_653b[5]](chalk[_$_653b[4]](_$_653b[7]));console[_$_653b[5]](chalk[_$_653b[4]](_$_653b[8]))